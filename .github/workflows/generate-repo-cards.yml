name: Generate Repo Cards

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */24 * * *'

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4

      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Generate repo cards
        run: |
          mkdir -p .github/profile/cards
          
          repos=(
            "Auto-Role-Channel-Bot-Discord"
            "UE-Widget-Development"
          )

          for repo in "${repos[@]}"; do
            json=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
                        "https://api.github.com/repos/AnikBeris/$repo")
            
            name=$(echo "$json" | jq -r '.name')
            description=$(echo "$json" | jq -r '.description // "No description"' | sed 's/&/\&amp;/g; s/</\&lt;/g; s/>/\&gt;/g')
            language=$(echo "$json" | jq -r '.language // "Unknown"')
            stars=$(echo "$json" | jq -r '.stargazers_count')
            
            [[ "$language" == "Python" ]]      && color="#3572A5"
            [[ "$language" == "JavaScript" ]]  && color="#f1e05a"
            [[ "$language" == "TypeScript" ]]  && color="#2b7489"
            [[ -z "$color" ]]                  && color="#666666"

            cat > ".github/profile/cards/$repo-card.svg" <<EOF
<svg width="400" height="140" viewBox="0 0 400 140" xmlns="http://www.w3.org/2000/svg">
  <rect width="400" height="140" rx="12" fill="#0f0f0f"/>
  <text x="20" y="35" fill="#58a6ff" font-family="Segoe UI, sans-serif" font-size="20" font-weight="600">$name</text>
  <text x="20" y="65" fill="#8b949e" font-family="Segoe UI, sans-serif" font-size="14">$description</text>
  <circle cx="25" cy="100" r="8" fill="$color"/>
  <text x="40" y="105" fill="#ffffff" font-family="Segoe UI, sans-serif" font-size="14">$language</text>
  <text x="305" y="105" fill="#8b949e" font-family="Segoe UI, sans-serif" font-size="14">‚≠ê</text>
  <text x="320" y="105" fill="#8b949e" font-family="Segoe UI, sans-serif" font-size="14" text-anchor="end">$stars</text>
</svg>
EOF
          done

      - name: Commit & push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add .github/profile/cards/
          git diff --staged --quiet || git commit -m "Update repo cards" && git push
